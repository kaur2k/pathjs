var Path={version:"0.8.4",map:function(e){if(Path.routes.defined.hasOwnProperty(e)){return Path.routes.defined[e]}else{return new Path.core.route(e)}},root:function(e){Path.routes.root=e},rescue:function(e){Path.routes.rescue=e},history:{initial:{},pushState:function(e,t,n){if(Path.history.supported){if(Path.dispatch(n)){history.pushState(e,t,n)}}else{if(Path.history.fallback){window.location.hash="#"+n}}},popState:function(e){var t=!Path.history.initial.popped&&location.href==Path.history.initial.URL;Path.history.initial.popped=true;if(t)return;Path.dispatch(document.location.pathname)},listen:function(e){Path.history.supported=!!(window.history&&window.history.pushState);Path.history.fallback=e;if(Path.history.supported){Path.history.initial.popped="state"in window.history,Path.history.initial.URL=location.href;window.onpopstate=Path.history.popState}else{if(Path.history.fallback){for(route in Path.routes.defined){if(route.charAt(0)!="#"){Path.routes.defined["#"+route]=Path.routes.defined[route];Path.routes.defined["#"+route].path="#"+route}}Path.listen()}}}},match:function(e,t){var n={},r=null,i,s,o,u,a;for(r in Path.routes.defined){if(r!==null&&r!==undefined){r=Path.routes.defined[r];i=r.partition();if(e.search(/\?[a-z0-9\-_=&]{1,}/i)>0){var f=e.match(/\?[a-z0-9\-_=&]{1,}/i),l;l=f[0].substring(1).split("&");for(var c in l){n[l[c].split("=")[0]||l[c]]=l[c].split("=")[1]||true}e=e.substring(0,e.search(/\?[a-z0-9\-_=&]+/gi))}for(u=0;u<i.length;u++){s=i[u];a=e;if(s.search(/:/)>0){for(o=0;o<s.split("/").length;o++){if(o<a.split("/").length&&s.split("/")[o].charAt(0)===":"){n[s.split("/")[o].replace(/:/,"")]=a.split("/")[o];a=a.replace(a.split("/")[o],s.split("/")[o])}}}if(s===a){if(t){r.params=n}return r}}}}return null},dispatch:function(e){var t,n;if(Path.routes.current!==e){Path.routes.previous=Path.routes.current;Path.routes.current=e;n=Path.match(e,true);if(Path.routes.previous){t=Path.match(Path.routes.previous);if(t!==null&&t.do_exit!==null){t.do_exit()}}if(n!==null){n.run();return true}else{if(Path.routes.rescue!==null){Path.routes.rescue()}}}},listen:function(){var e=function(){Path.dispatch(location.hash)};if(location.hash===""){if(Path.routes.root!==null){location.hash=Path.routes.root}}if("onhashchange"in window&&(!document.documentMode||document.documentMode>=8)){window.onhashchange=e}else{setInterval(e,50)}if(location.hash!==""){Path.dispatch(location.hash)}},core:{route:function(e){this.path=e;this.action=null;this.do_enter=[];this.do_exit=null;this.params={};Path.routes.defined[e]=this}},routes:{current:null,root:null,rescue:null,previous:null,defined:{}}};Path.core.route.prototype={to:function(e){this.action=e;return this},enter:function(e){if(e instanceof Array){this.do_enter=this.do_enter.concat(e)}else{this.do_enter.push(e)}return this},exit:function(e){this.do_exit=e;return this},partition:function(){var e=[],t=[],n=/\(([^}]+?)\)/g,r,i;while(r=n.exec(this.path)){e.push(r[1])}t.push(this.path.split("(")[0]);for(i=0;i<e.length;i++){t.push(t[t.length-1]+e[i])}return t},run:function(){var e=false,t,n,r;if(Path.routes.defined[this.path].hasOwnProperty("do_enter")){if(Path.routes.defined[this.path].do_enter.length>0){for(t=0;t<Path.routes.defined[this.path].do_enter.length;t++){n=Path.routes.defined[this.path].do_enter[t].apply(this,null);if(n===false){e=true;break}}}}if(!e){Path.routes.defined[this.path].action()}}}